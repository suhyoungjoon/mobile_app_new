# main ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œ Render(ë°±ì—”ë“œ)Â·Vercel(í”„ë¡ íŠ¸) ìë™ ë°°í¬
# - Render: ì €ì¥ì†Œ ì—°ê²° ì‹œ pushë§ˆë‹¤ ìë™ ë¹Œë“œÂ·ë°°í¬ (render.yaml ê¸°ì¤€)
# - Vercel: ì €ì¥ì†Œ ì—°ê²° ì‹œ pushë§ˆë‹¤ ìë™ ë°°í¬
name: Deploy

on:
  push:
    branches: [main]

jobs:
  # í‘¸ì‹œ ì‹œ ë°°í¬ íŠ¸ë¦¬ê±° í™•ì¸ (Render/Vercelì´ ê°ì ë°°í¬ ìˆ˜í–‰)
  deploy-trigger:
    runs-on: ubuntu-latest
    steps:
      - name: ë°°í¬ íŠ¸ë¦¬ê±°
        run: |
          echo "âœ… mainì— pushë˜ì—ˆìŠµë‹ˆë‹¤."
          echo "ğŸ“¦ Render(ë°±ì—”ë“œ)ì™€ Vercel(í”„ë¡ íŠ¸)ì´ ì—°ê²°ë˜ì–´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ë°°í¬ê°€ ì‹œì‘ë©ë‹ˆë‹¤."
          echo "   - ë°±ì—”ë“œ: https://dashboard.render.com"
          echo "   - í”„ë¡ íŠ¸: https://vercel.com/dashboard"

  # ë°±ì—”ë“œ í—¬ìŠ¤ ì²´í¬ (ë°°í¬ ì™„ë£Œ í›„ ì„œë²„ ì‘ë‹µ í™•ì¸, ì„ íƒ)
  verify-backend:
    runs-on: ubuntu-latest
    needs: deploy-trigger
    steps:
      - name: ëŒ€ê¸° í›„ ë°±ì—”ë“œ í—¬ìŠ¤ ì²´í¬
        run: |
          echo "â³ Render ë¹Œë“œ ëŒ€ê¸° ì¤‘ (ì•½ 4ë¶„)..."
          sleep 240
          curl -sf --max-time 30 https://mobile-app-new.onrender.com/health || echo "âš ï¸ í—¬ìŠ¤ ì²´í¬ ì‹¤íŒ¨ (ì„œë²„ ëŒ€ê¸° ì¤‘ì´ê±°ë‚˜ URL í™•ì¸ í•„ìš”)"
        continue-on-error: true
