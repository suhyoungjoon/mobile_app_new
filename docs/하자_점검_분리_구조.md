# 하자 vs 점검 분리 구조 확인

## 1. 요약

- **하자(Defect)**: 세대주가 등록. 점검원은 **조회만** 가능 (수정/삭제 없음).
- **점검(Inspection)**: 점검원이 **세대(household) 단위**로 입력. 하자와 1:1로 묶이지 않음.

---

## 2. 백엔드

### 2.1 하자 (defect)

| 구분 | 내용 |
|------|------|
| 등록/수정 | 세대주(입주자) 앱에서만. `POST/GET/PUT /api/defects` 등. |
| 점검원 | `GET /api/defects/by-household/:householdId` 로 **조회만**. 해당 세대의 하자 목록 + 사진. |

### 2.2 점검 (inspection_item)

| 구분 | 내용 |
|------|------|
| 저장 키 | `case_id` (세대의 케이스 1개) 필수. `defect_id`는 **선택**(세대별 점검 시 null). |
| 점검 입력 | `POST /api/inspections/visual`, `/air`, `/radon`, `/level`, `/thermal` 시 `caseId` + `defectId`(선택). 세대별이면 `defectId` 없이 호출 → DB에 `defect_id = null`. |
| 점검 조회 (세대 기준) | `GET /api/inspections/by-household/:householdId` → `WHERE ii.case_id IN (SELECT id FROM case_header WHERE household_id = $1)` (**하자 무관**, 세대별 N건). |
| 점검 조회 (하자 기준) | `GET /api/inspections/defects/:defectId` → `WHERE ii.defect_id = $1`. 세대별만 쓰면 대부분 `defect_id`가 null이라 결과 없을 수 있음. |
| 최종보고서 | `loadHouseholdInspectionsForReport(householdId)` 로 **세대 기준**만 사용. `defect` 테이블 조인 없음. |

---

## 3. 프론트(점검원)

### 3.1 흐름

1. **사용자 목록** → 하자가 등록된 세대 목록 (조회).
2. **하자목록** → 해당 세대의 하자 카드 **조회 전용**.  
   - **점검결과 입력** 버튼 → `openInspectionForHousehold(householdId)` 호출 (하자 선택 없음).
3. **점검결과 입력** 화면 → **세대 정보** + (참고용) 세대주 등록 하자 + 육안/공기질/라돈/레벨기/열화상 탭으로 **세대별** 점검 입력.  
   - 저장 시 `defectId = null` 로 API 호출 → `inspection_item.defect_id = null`.

### 3.2 하자 선택 모달

- `openDefectSelectModal()`: **현재 어디서도 호출되지 않음.**  
- 즉, **하자 선택 후 점검 입력** 경로는 사용되지 않고, 실사용은 **세대별 점검 입력**만 해당.

### 3.3 점검결과 보기

- **세대 단위**: 점검결과 입력 화면의 **「입력된 점검결과 보기」** → `getInspectionsByHousehold(householdId)` 로 세대별 저장 건 표시.
- **하자 카드의 「점검결과 보기」**: `getDefectInspections(defectId)` 사용.  
  - 세대별만 쓰면 `defect_id`가 null이라 하자별 조회 결과는 비어 있을 수 있음. (과거 하자별 입력 데이터가 있으면 그때만 표시됨.)

---

## 4. 정리

| 항목 | 구조 |
|------|------|
| 하자 | 세대주 등록, 점검원은 **보기만**. |
| 점검 | 점검원이 **세대(household) 단위**로 입력. `case_id` 기준, `defect_id`는 선택(null 가능). |
| 최종보고서 | 세대별 점검 데이터만 사용 (하자 테이블과 무관). |
| UI 진입 | 점검결과 입력 = 항상 **세대별** (`openInspectionForHousehold`). 하자 선택 모달은 미사용. |

이 구조에 맞춰 화면 문구만 「세대주 등록 하자 (참고용)」「점검결과는 세대별로 입력됩니다」 등으로 정리해 두면 됨.
