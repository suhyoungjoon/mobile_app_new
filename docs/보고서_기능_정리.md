# 보고서 기능 정리

## 1. 생성되는 보고서 종류 (PDF)

| 구분 | API template 값 | 파일명 예시 | 생성기 | 용도 |
|------|-----------------|-------------|--------|------|
| **최종보고서** | `final-report` | `보고서_최종_2-696_202602120220.pdf` | `finalReportGenerator.js` (pdf-lib) | 템플릿 PDF(1~7,9,11,14~15p) 유지 + 8·10·12·13p 자리에 육안/열화상/공기질/레벨기 **블록형** 점검결과 페이지. N개 항목 시 추가 페이지 자동. |
| **수기보고서** | `summary-report` | `수기보고서_2-696_202602120219.pdf` | `pdfmakeGenerator.js` | 세대별 하자 요약(위치·공종·내용·특이사항·사진 등). |
| **점검결과 양식** | `inspection-form` | `점검결과양식_2-696_202602120220.pdf` | `pdfmakeGenerator.js` | 점검결과 입력용 양식(1p 세대정보, 2p~ 육안/열화상/공기질/레벨기). |
| **종합보고서(기본)** | `comprehensive-report` (또는 미지정) | `report-{householdId}-{timestamp}.pdf` | `pdfmakeGenerator.js` | 하자 목록 + 점검 장비 요약 전체. 「PDF 다운로드」「PDF 미리보기」 및 **보고서 발송(SMS)** 에 사용. |

- **최종보고서**만 별도 템플릿 PDF(`backend/templates/종합점검보고서_최종1.pdf`) + pdf-lib 사용, 나머지는 pdfmake + 한글 폰트로 생성.

---

## 2. API 정리

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | `/api/reports/preview` | 세대 기준 하자+점검 데이터 조회. 미리보기 HTML·JSON 반환. |
| POST | `/api/reports/generate` | PDF 생성. `body.template`: `final-report` \| `summary-report` \| `inspection-form` \| `comprehensive-report`(기본). |
| POST | `/api/reports/generate-pptx` | **이미 비활성(410)**. PDF만 지원 안내. |
| POST | `/api/reports/send` | 종합보고서 PDF 생성 후 SMS로 링크 발송. |
| GET | `/api/reports/preview-pdf/:filename` | 생성된 PDF 브라우저 미리보기(inline). |
| GET | `/api/reports/download/:filename` | 생성된 PDF 다운로드(attachment). |

- 정적 경로: `GET /reports/:filename` → `backend/reports/` 폴더 서빙.

---

## 3. 프론트(점검원 화면) 정리

**화면:** `webapp/inspector.html` → `#report` (보고서 탭)

**노출 버튼 (다운로드·미리보기 가능한 보고서는 최종보고서·수기보고서만)**

| 버튼 | 호출 API | template | 비고 |
|------|----------|----------|------|
| **최종보고서 다운로드** | POST `/api/reports/generate` | `final-report` | 메인. |
| **최종보고서 미리보기** | generate → GET preview-pdf | `final-report` | 새 창. |
| **수기보고서 다운로드** | POST generate | `summary-report` | |
| **수기보고서 미리보기** | generate → GET preview-pdf | `summary-report` | 새 창. |

- **화면에서 제거된 버튼:** 「PDF 다운로드」(종합보고서), 「점검결과 양식」. (API·백엔드 기능은 유지.)
- 사용자 목록에서 「보고서 미리보기」→ 보고서 화면으로 이동 + 하자 목록 표시.
- 사용자 목록에서 「보고서 다운로드」→ **최종보고서** 생성 후 다운로드.

---

## 4. 백엔드 파일 역할

| 파일 | 역할 |
|------|------|
| `backend/routes/reports.js` | 보고서 API 전부. preview, generate, send, preview-pdf, download. |
| `backend/utils/finalReportGenerator.js` | **최종보고서**만 생성. 템플릿 로드 + 블록형 페이지 그리기. |
| `backend/utils/finalReportLayout.js` | 최종보고서 블록 레이아웃 상수. |
| `backend/utils/pdfmakeGenerator.js` | 수기보고서·점검결과양식·종합보고서 PDF (pdfmake). |
| `backend/templates/comprehensive-report.hbs` | 미리보기 **HTML** 생성용 (generateComprehensiveReportHTML). |
| `backend/templates/종합점검보고서_최종1.pdf` | 최종보고서용 기초 템플릿. |

---

## 5. 불필요/정리 대상 제안

### 5.1 비활성화·제거 후보

- **종합보고서(comprehensive-report)**  
  - 용도: PDF 다운로드·미리보기·SMS 발송.  
  - **최종보고서만** 쓸 계획이면:  
    - 「PDF 다운로드」「PDF 미리보기」를 **최종보고서**로 통일하고,  
    - `comprehensive-report` 분기와 `/send`에서 쓰는 종합보고서 생성은 **비활성화**하거나 제거 가능.

- **수기보고서(summary-report)**  
  - 하자 요약용. 최종보고서로 대체 가능하면 **기타 보고서**에서 버튼만 숨기거나 API 분기 제거.

- **점검결과 양식(inspection-form)**  
  - 점검 입력용 양지. 실제로 사용하지 않으면 **기타 보고서**에서 버튼 숨기거나 제거.

- **보고서 발송(SMS)**  
  - `POST /api/reports/send`: 종합보고서 생성 후 SMS. 사용 안 하면 라우트 비활성화 또는 제거.

### 5.2 dead code

- `backend/routes/reports.js` 내 **generateReportHTML**  
  - 어디서도 호출되지 않음. **삭제**해도 동작 영향 없음.

### 5.3 유지 권장

- **최종보고서** 생성·다운로드·미리보기: 핵심 기능.
- **미리보기 데이터** (GET `/api/reports/preview`): 화면에 하자 목록 표시용.
- **preview-pdf / download**: 생성된 PDF 조회·다운로드.

---

## 6. 정리 시 체크리스트 (비활성화 시)

1. **UI**  
   - [ ] 「PDF 다운로드」를 최종보고서로 바꾸거나 제거  
   - [ ] 「PDF 미리보기」를 최종보고서 기준으로 할지 결정  
   - [ ] 「기타 보고서」에서 수기보고서·점검결과 양식 버튼 숨기기/제거  

2. **API**  
   - [ ] `POST /generate`에서 `summary-report`, `inspection-form`, `comprehensive-report` 분기 제거 또는 비활성화  
   - [ ] `POST /send` 비활성화 또는 제거  
   - [ ] `generateReportHTML` 함수 삭제  

3. **생성기**  
   - [ ] `pdfmakeGenerator`에서 수기/점검결과 양식/종합 정의 사용처 제거 후, 필요 시 해당 메서드만 비활성화  

4. **문서/스크립트**  
   - [ ] `download-reports.js` 등에서 수기/점검결과 양식 파일명 참조 제거  

원하시는 방향(예: 최종보고서만 남기기, 수기·양식만 숨기기 등)에 맞춰 위 항목만 선택 적용하시면 됩니다.
