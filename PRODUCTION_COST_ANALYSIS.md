# 💰 InsightI 상용 서비스 비용 분석 및 추가 작업

## 📊 운영 조건 요약

### 사용자 규모
- **일반 사용자 (입주자)**: 100명
- **점검원**: 10명
- **관리자**: 1명
- **총 사용자**: 111명

### 트랜잭션
- **일일 트랜잭션**: 300회 (사용자 100 + 점검원 100 + 관리자 100)
- **월간 트랜잭션**: 약 9,000회 (30일 기준)
- **연간 트랜잭션**: 약 108,000회

### 데이터 생성
- **사진 파일**: 일 100개, 보관 1개월 = 약 3,000개/월
- **AI 판정**: 일 50회 제한
- **보고서**: 월 100개, 보관 1개월 = 약 100개/월

---

## 💵 월간 비용 분석

### 1. 프론트엔드 호스팅 (Vercel)

#### 현재: 업그레이드된 플랜 (한 단계 업그레이드)
- **비용**: $0/월 (Hobby 플랜) 또는 $20/월 (Pro 플랜)
- **대역폭**: 100GB/월 (Hobby) 또는 1TB/월 (Pro)
- **요청**: 무제한
- **빌드 시간**: 100분/월 (Hobby) 또는 5,000분/월 (Pro)
- **커스텀 도메인**: 지원
- **SSL 인증서**: 자동
- **CDN**: 전 세계 분산

#### 예상 사용량
- **대역폭**: 약 50GB/월 (충분)
- **빌드**: 월 1-2회 (충분)

> **참고**: 현재 Vercel은 한 단계 업그레이드된 상태입니다. 정확한 플랜 및 비용은 Vercel 대시보드에서 확인하세요.

---

### 2. 백엔드 호스팅 (Render)

#### 현재: Free 플랜
- **Cold Start**: 최대 30초
- **Sleep**: 15분 비활성 시 대기 모드
- **CPU/RAM**: 제한적

#### 상용 서비스 필수: Starter 플랜
- **비용**: $7/월 (약 9,500원)
- **CPU/RAM**: 512MB RAM, 0.5 CPU
- **Cold Start**: 없음 (항상 실행)
- **대역폭**: 100GB/월
- **로그 보관**: 7일

#### 예상 사용량
- **일일 트랜잭션**: 300회 = 시간당 약 12.5회
- **피크 시간대**: 동시 접속 최대 20-30명
- **512MB RAM**: 충분
- **대역폭**: 약 10GB/월 (충분)

#### 대안: Professional 플랜 ($25/월)
- **CPU/RAM**: 1GB RAM, 1 CPU
- **대역폭**: 1TB/월
- **로그 보관**: 30일
- **자동 스케일링**: 지원

---

### 3. 데이터베이스 (Render PostgreSQL)

#### 현재: Starter 플랜 ($7/월) ✅ 업그레이드 완료
- **비용**: $7/월 (약 9,500원)
- **데이터 보관**: 무제한
- **용량**: 1GB (필요 시 확장 가능)
- **자동 백업**: 7일간 보관
- **연결 수**: 최대 25개

> **참고**: 현재 Render PostgreSQL은 무료 플랜에서 Starter 플랜($7/월)으로 업그레이드되어 있습니다.

#### 데이터 용량 계산
```
사진 파일 (1개월):
- 100개/일 × 30일 = 3,000개
- 평균 500KB/파일 = 1.5GB

보고서 (1개월):
- 100개/월 × 30일 = 100개
- 평균 2MB/파일 = 200MB

데이터베이스:
- 사용자 데이터: 약 10MB
- 하자 데이터: 약 50MB
- 점검 데이터: 약 50MB
- 총합: 약 110MB

총 필요 용량: 약 1.86GB
```

#### 권장: Professional 플랜 ($20/월)
- **용량**: 10GB
- **자동 백업**: 30일간 보관
- **연결 수**: 최대 100개
- **고성능**: 더 빠른 쿼리 처리

---

### 4. 파일 스토리지 (사진 및 보고서)

#### 옵션 1: Render 디스크 공간 (백엔드 서버 내부)
- **비용**: 포함 (백엔드 플랜에 포함)
- **제한**: 서버 재시작 시 삭제 가능
- **권장 여부**: ❌ 개발/테스트용

#### 옵션 2: AWS S3 (권장)
- **비용**: $0.023/GB/월 (스토리지)
  - 약 2GB 저장 = $0.046/월 (약 62원)
- **비용**: $0.005/1,000 요청 (GET)
  - 일 300회 × 30일 = 9,000회 = $0.045/월
- **비용**: $0.0004/1,000 요청 (PUT)
  - 일 200회 × 30일 = 6,000회 = $0.0024/월
- **총 비용**: 약 $0.10/월 (약 135원)
- **장점**: 영구 보관, 안정적, 확장 가능

#### 옵션 3: Azure Blob Storage
- **비용**: $0.018/GB/월 (LRS)
  - 약 2GB = $0.036/월
- **비용**: $0.004/10,000 요청
  - 약 15,000회 = $0.006/월
- **총 비용**: 약 $0.04/월 (약 54원)

#### 옵션 4: Google Cloud Storage
- **비용**: $0.020/GB/월
  - 약 2GB = $0.04/월
- **비용**: $0.005/10,000 요청
  - 약 15,000회 = $0.0075/월
- **총 비용**: 약 $0.05/월 (약 68원)

---

### 5. AI 판정 (Azure OpenAI)

#### GPT-4o Vision API 비용
- **입력 비용**: $0.0025/1K 토큰
- **출력 비용**: $0.01/1K 토큰
- **이미지 분석**: $0.01/이미지

#### 예상 사용량
- **일일**: 50회
- **월간**: 1,500회
- **이미지당 평균**: 
  - 입력 토큰: 500 토큰 (이미지 설명 포함)
  - 출력 토큰: 200 토큰 (판정 결과)

#### 비용 계산
```
일 50회:
- 이미지 분석: 50 × $0.01 = $0.50
- 입력 토큰: 50 × 500/1000 × $0.0025 = $0.0625
- 출력 토큰: 50 × 200/1000 × $0.01 = $0.10
일일 총합: $0.6625

월간 (30일):
- 총 비용: $0.6625 × 30 = $19.875
- 약 27,000원
```

#### 비용 절감 옵션
- **로컬 AI 우선**: 50회 제한 내에서 클라우드 호출 최소화
- **GPT-4o 미니 사용**: 저렴한 모델로 대체 (정확도는 낮음)

---

### 6. YouTube API (Google Cloud)

#### YouTube Data API v3 비용
- **무료 할당량**: 일 10,000 단위
- **검색 1회**: 약 100 단위
- **일일 최대**: 약 100회 검색

#### 예상 사용량
- **하자 등록**: 일 100회
- **검색 단위**: 100 × 100 = 10,000 단위
- **비용**: **$0 (무료 할당량 내)**

---

### 7. 푸시 알림 (VAPID 기반 Web Push)

#### 비용
- **VAPID 키**: 무료 (자체 생성)
- **알림 발송**: 무료 (브라우저 제공)
- **구독 저장**: 데이터베이스 저장 (PostgreSQL)
- **총 비용**: **$0**

---

### 8. SMS 알림 (Twilio) - 선택사항

#### 비용
- **전송 비용**: $0.005/건 (한국)
- **예상 사용량**: 보고서 발송 시 SMS
  - 월 100회 × $0.005 = $0.50/월
- **월 최소**: $0 (무료 크레딧 $15.50 제공)

---

## 💰 월간 총 비용 요약

### 현재 구성 (실제 운영 중)
| 항목 | 플랜 | 월간 비용 | 원화 (KRW) |
|------|------|----------|------------|
| 프론트엔드 | Vercel (업그레이드) | $0-$20 | 0-27,000원 |
| 백엔드 | Render Starter | $7 | 9,500원 |
| 데이터베이스 | Render PostgreSQL Starter | $7 | 9,500원 |
| 파일 스토리지 | Render 디스크 (백엔드 포함) | $0 | 0원 |
| AI 판정 | Azure OpenAI (선택) | $0-$20 | 0-27,000원 |
| SMS | Twilio (선택) | $0.50 | 675원 |
| **총계** | | **$14.50-$54.50** | **약 19,600원-73,600원** |

> **참고**: 
> - Vercel 플랜에 따라 비용이 달라집니다 (Hobby: $0/월, Pro: $20/월)
> - AI 판정은 선택사항이며, 사용하지 않으면 $0입니다
> - 파일 스토리지는 현재 Render 백엔드 디스크를 사용 중입니다

### 최소 구성 (기본 운영)
| 항목 | 플랜 | 월간 비용 | 원화 (KRW) |
|------|------|----------|------------|
| 프론트엔드 | Vercel Pro | $20 | 27,000원 |
| 백엔드 | Render Starter | $7 | 9,500원 |
| 데이터베이스 | Render PostgreSQL Starter | $7 | 9,500원 |
| 파일 스토리지 | AWS S3 | $0.10 | 135원 |
| AI 판정 | Azure OpenAI | $20 | 27,000원 |
| SMS | Twilio (선택) | $0.50 | 675원 |
| **총계** | | **$54.60** | **약 73,800원** |

### 권장 구성 (안정적 운영)
| 항목 | 플랜 | 월간 비용 | 원화 (KRW) |
|------|------|----------|------------|
| 프론트엔드 | Vercel Pro | $20 | 27,000원 |
| 백엔드 | Render Professional | $25 | 34,000원 |
| 데이터베이스 | Render PostgreSQL Professional | $20 | 27,000원 |
| 파일 스토리지 | AWS S3 | $0.10 | 135원 |
| AI 판정 | Azure OpenAI | $20 | 27,000원 |
| SMS | Twilio (선택) | $0.50 | 675원 |
| **총계** | | **$85.60** | **약 115,600원** |

---

## 🚀 추가로 해야 될 작업

### 1. 인프라 개선 (필수)

#### 파일 스토리지 마이그레이션
- [ ] **AWS S3 연동 구현**
  - 파일 업로드 로직 수정 (`backend/utils/fileUpload.js`)
  - S3 SDK 설치 및 설정
  - 환경변수 설정 (AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, S3_BUCKET_NAME)
  - 기존 파일 마이그레이션 스크립트 작성

#### 데이터 백업 자동화
- [ ] **데이터베이스 자동 백업 설정**
  - Render PostgreSQL 자동 백업 확인
  - 추가 백업 스크립트 작성 (S3에 저장)
  - 월 1회 전체 백업 다운로드 및 보관

#### 모니터링 및 로깅
- [ ] **에러 모니터링 도구 설정**
  - Sentry 또는 LogRocket 연동
  - 비용: Sentry Team 플랜 $26/월 또는 무료 플랜 사용
- [ ] **성능 모니터링**
  - Render 기본 모니터링 활용
  - 사용자 정의 메트릭 수집

---

### 2. 데이터 관리 (필수)

#### 자동 삭제 스케줄러
- [ ] **1개월 이상 된 파일 자동 삭제**
  - 백엔드에 스케줄러 작업 추가 (node-cron)
  - 매일 실행하여 만료된 파일 삭제
  - S3에서 파일 삭제 및 DB 레코드 삭제

#### 데이터 정리 작업
- [ ] **보고서 자동 삭제**
  - 1개월 경과 보고서 자동 삭제
  - PDF 파일 및 DB 레코드 삭제

#### 용량 모니터링
- [ ] **스토리지 사용량 알림**
  - 용량이 80% 초과 시 관리자에게 알림
  - 주간 사용량 리포트

---

### 3. AI 판정 제한 구현 (필수)

#### 일일 할당량 제한
- [ ] **일일 50회 제한 로직 구현**
  - 사용자별 일일 사용량 추적 테이블 생성
  - API 엔드포인트에 제한 로직 추가
  - 50회 초과 시 로컬 AI만 사용하도록 변경

```sql
CREATE TABLE ai_usage_daily (
  id SERIAL PRIMARY KEY,
  household_id INTEGER REFERENCES household(id),
  usage_date DATE NOT NULL,
  usage_count INTEGER DEFAULT 0,
  last_used_at TIMESTAMP,
  UNIQUE(household_id, usage_date)
);
```

#### 사용량 대시보드
- [ ] **관리자 페이지에 AI 사용량 표시**
  - 일일/월간 사용량 통계
  - 사용자별 사용량 추적

---

### 4. 성능 최적화 (권장)

#### 이미지 최적화
- [ ] **이미지 압축 강화**
  - 현재 Sharp 사용 중, 압축 레벨 조정
  - WebP 포맷 지원 추가 (용량 30% 절감)
  - 썸네일 생성 최적화

#### 데이터베이스 최적화
- [ ] **인덱스 최적화**
  - 쿼리 성능 분석
  - 필요한 인덱스 추가
  - 불필요한 인덱스 제거

#### 캐싱 전략
- [ ] **Redis 캐싱 추가** (선택)
  - 자주 조회되는 데이터 캐싱
  - 비용: Render Redis $10/월 또는 Upstash 무료 플랜

---

### 5. 보안 강화 (필수)

#### SSL 인증서
- [ ] **커스텀 도메인 SSL 설정**
  - Vercel 자동 SSL 활용
  - Render SSL 인증서 설정

#### API 보안
- [ ] **Rate Limiting 구현**
  - 사용자별 요청 제한 (분당/시간당)
  - DDoS 방어

#### 데이터 암호화
- [ ] **민감 정보 암호화**
  - 개인정보 필드 암호화
  - 비밀번호 해싱 확인

---

### 6. 운영 관리 도구 (권장)

#### 관리자 대시보드 개선
- [ ] **통계 대시보드 추가**
  - 실시간 사용자 수
  - 일일/월간 트랜잭션 통계
  - 스토리지 사용량
  - AI 사용량 통계

#### 알림 시스템
- [ ] **시스템 알림 설정**
  - 에러 발생 시 Slack/이메일 알림
  - 용량 경고 알림
  - 성능 저하 알림

---

### 7. 확장성 준비 (향후 대비)

#### 스케일링 전략
- [ ] **로드 밸런싱 준비**
  - 트래픽 증가 시 다중 인스턴스 운영 가능하도록 설계
  - Render Auto-scaling 설정

#### 데이터베이스 확장
- [ ] **읽기 전용 복제본 설정** (향후)
  - 트래픽 증가 시 읽기 부하 분산
  - 비용: Render PostgreSQL 복제본 $20/월

---

## 📋 우선순위별 작업 계획

### Phase 1: 필수 작업 (즉시 진행)
1. **파일 스토리지 S3 마이그레이션** (1주)
2. **자동 삭제 스케줄러 구현** (3일)
3. **AI 일일 50회 제한 구현** (2일)
4. **Rate Limiting 구현** (2일)

### Phase 2: 중요 작업 (1개월 내)
5. **데이터 백업 자동화** (3일)
6. **모니터링 도구 설정** (3일)
7. **관리자 대시보드 개선** (1주)
8. **성능 최적화** (1주)

### Phase 3: 선택 작업 (필요 시)
9. **Redis 캐싱 추가**
10. **읽기 전용 복제본 설정**

---

## 💡 비용 절감 팁

### 1. AI 비용 절감
- **로컬 AI 신뢰도 조정**: 신뢰도 0.8 이상이면 클라우드 호출 안 함
- **일일 제한 강화**: 사용자별 일일 3-5회로 제한
- **GPT-4o 미니 사용**: 정확도 허용 범위 내에서 저렴한 모델 사용

### 2. 스토리지 비용 절감
- **이미지 압축 강화**: 품질 80%로 낮춰 용량 절감
- **WebP 포맷 사용**: JPEG 대비 30% 용량 절감
- **보관 기간 단축**: 1개월 → 2주 (협의 필요)

### 3. 호스팅 비용 절감
- **프론트엔드**: Vercel Pro 유지 (무료 플랜으로는 부족)
- **백엔드**: Starter 플랜으로 시작, 트래픽 증가 시 Professional 업그레이드
- **데이터베이스**: Starter 플랜으로 시작 (1GB 충분), 필요 시 업그레이드

---

## 📊 예상 월간 총 비용

### 현재 구성 (실제 운영 중)
**약 19,600원-73,600원/월** (약 $14.50-$54.50/월)
- Vercel 플랜에 따라 비용 차이
- AI 판정 사용 여부에 따라 비용 차이
- Render PostgreSQL Starter 플랜 ($7/월) 적용

### 최소 구성 (기본 운영)
**약 73,800원/월** (약 $54.60/월)
- Render PostgreSQL Starter 플랜 ($7/월) 적용
- 파일 스토리지 S3 사용

### 권장 구성 (안정적 운영)
**약 115,600원/월** (약 $86/월)
- Professional 플랜 적용

### 연간 비용
- **현재 구성**: 약 235,200원-883,200원/년
- **최소 구성**: 약 885,600원/년
- **권장 구성**: 약 1,387,200원/년

---

## 🎯 결론

### 현재 운영 구성
- **프론트엔드**: Vercel (업그레이드된 플랜) ($0-$20/월)
- **백엔드**: Render Starter ($7/월)
- **데이터베이스**: Render PostgreSQL Starter ($7/월) ✅ **업그레이드 완료**
- **파일 스토리지**: Render 디스크 (백엔드 포함) ($0/월)
- **AI 판정**: Azure OpenAI (선택사항) ($0-$20/월)
- **총 비용**: 약 $14.50-$54.50/월 (약 19,600원-73,600원)

### 업그레이드 효과
- **Render PostgreSQL**: 무료 플랜 → Starter 플랜 ($7/월)로 업그레이드
  - 무제한 데이터 보관
  - 자동 백업 (7일간 보관)
  - 안정적인 연결 (최대 25개)
- **Vercel**: 무료 플랜 → 한 단계 업그레이드
  - 향상된 성능 및 기능

### 추천 향후 구성 (트래픽 증가 시)
- **프론트엔드**: Vercel Pro ($20/월)
- **백엔드**: Render Professional ($25/월)
- **데이터베이스**: Render PostgreSQL Professional ($20/월)
- **파일 스토리지**: AWS S3 ($0.10/월)
- **AI 판정**: Azure OpenAI ($20/월)
- **총 비용**: 약 $85.60/월 (약 115,600원)

### 우선 작업
1. 파일 스토리지 S3 마이그레이션 (안정성 향상)
2. 자동 삭제 스케줄러
3. AI 일일 50회 제한
4. Rate Limiting 구현

### 현재 상태 요약
✅ **Render PostgreSQL Starter 플랜($7/월)으로 업그레이드 완료**  
✅ **Vercel 한 단계 업그레이드 완료**  
✅ **안정적인 서비스 운영 구성 완료**  

현재 구성으로도 안정적인 서비스 운영이 가능하며, 트래픽 증가 시 단계적으로 업그레이드할 수 있습니다! 🚀

