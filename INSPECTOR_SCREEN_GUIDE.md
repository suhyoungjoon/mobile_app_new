# 점검원 화면 로그인 방법 및 기능 정리

## 접속 URL

- **로컬:** `http://localhost:8080/inspector.html` (또는 웹 서버로 서빙한 경로)
- **배포:** `https://[프론트도메인]/inspector.html`  
  (예: Vercel 등에 웹앱 배포 시 해당 도메인/inspector.html)

---

## 1. 로그인 방법

### 1.1 자동 로그인 (화면에 로그인 폼 없음)

점검원 화면에는 **로그인 입력창이 없습니다.**  
페이지를 열면 **점검원 전용 계정으로 자동 로그인**을 시도합니다.

- **동작 순서**
  1. 페이지 로드 → 하자목록 화면이 바로 표시되고 "점검원 계정으로 로그인 중..." 메시지 표시
  2. `localStorage`에 `inspector_session`이 있으면 **저장된 토큰으로 세션 복원** 시도
  3. 토큰이 없거나 만료되었으면 **자동 로그인 API** 호출
  4. 로그인 성공 시 하자목록 조회 후 **하자목록 전체** 화면 표시

### 1.2 점검원 계정 (자동 로그인에 사용되는 값)

| 항목   | 값            |
|--------|----------------|
| 아파트(단지) | **admin**      |
| 동     | 000            |
| 호     | 000            |
| 성명   | 점검원         |
| 연락처 | 010-0000-0000  |

- 백엔드에서 **complex 이름이 "admin"인 세대**만 점검원 권한(`requireInspectorAccess`)으로 인정합니다.
- DB에 **complex 이름이 "admin"인 단지**와 그에 속한 **세대(동 000, 호 000 등)**가 미리 등록되어 있어야 자동 로그인이 성공합니다.

### 1.3 로그아웃

- 화면 우측 상단 **「로그아웃」** 버튼 클릭
- 확인 후 로그아웃되며, **같은 점검원 계정으로 자동 재로그인**됩니다. (다른 계정으로 바꾸는 기능은 없음)

---

## 2. 점검원 화면 기능 요약

| 기능 | 설명 |
|------|------|
| **하자목록 전체** | 모든 케이스의 하자를 한 목록으로 조회 (점검원용 API `GET /api/defects/all`) |
| **보고서 미리보기** | 하자·장비점검 데이터를 화면에서 확인 후, PDF 생성·다운로드·SMS 발송으로 이어짐 |
| **점검결과 입력** | 하자별로 공기질/라돈/레벨기/열화상 측정값 및 사진 입력·저장 |
| **PDF 미리보기** | 생성된 PDF를 브라우저 새 창에서 열기 |
| **PDF 다운로드** | 생성된 PDF 파일 다운로드 |
| **SMS 발송** | PDF 보고서 링크 SMS 발송 (실제 발송은 비활성화 가능, 모의 동작) |

---

## 3. 화면별 상세

### 3.1 하자목록 전체 (`#defect-list`)

- **상단:** 제목 "하자목록 전체", **로그아웃** 버튼
- **버튼:** 「보고서 미리보기」 → 보고서 화면으로 이동
- **목록:** 각 하자 카드에 **위치, 공종, 내용, 메모**, 공기질/라돈/레벨기/열화상 점검 여부(뱃지), **「점검결과 입력」** 버튼
- **점검결과 입력** 클릭 시 해당 하자에 대한 점검결과 입력 화면으로 이동

### 3.2 보고서 (`#report`)

- **보고서 미리보기:** 하자 목록(카드) 표시, 케이스 ID 저장(보고서 생성 시 사용)
- **PDF 미리보기:** 서버에 PDF 생성 요청 후 브라우저 새 창에서 PDF 표시
- **PDF 다운로드:** 서버에 PDF 생성 요청 후 파일 다운로드
- **SMS 발송:** 전화번호 입력 후 보고서 발송 (실제 발송 여부는 서버 설정에 따름)

### 3.3 점검결과 입력 (`#defect-inspection`)

- **하자 정보:** 선택한 하자의 위치/공종/내용 등 표시
- **탭:** 공기질 | 라돈 | 레벨기 | 열화상
- **공기질:** 위치, 공정, TVOC/HCHO/CO2, 메모, 결과(이상없음/확인요망/해당없음), **사진 추가**
- **라돈:** 위치, 공정, 라돈 값, 메모, 결과, **사진 추가**
- **레벨기:** 위치, 공정, 좌측(mm)/우측(mm), 메모, 결과, **사진 추가**
- **열화상:** 위치, **사진 추가**, 점검내용(메모)
- **버튼:** 「재설정」으로 폼 초기화, 「저장」으로 측정값·사진 전송

---

## 4. 사용 API (점검원 권한)

| 메서드 | 경로 | 용도 |
|--------|------|------|
| POST | `/api/auth/session` | 로그인(세션 발급) |
| GET | `/api/defects/all` | 하자목록 전체 조회 (점검원 전용) |
| GET | `/api/inspections/defects/:defectId` | 하자별 측정값 조회 |
| POST | `/api/inspections/air` | 공기질 측정 저장 |
| POST | `/api/inspections/radon` | 라돈 측정 저장 |
| POST | `/api/inspections/level` | 레벨기 측정 저장 |
| POST | `/api/inspections/thermal` | 열화상 점검 저장 |
| POST | `/api/inspections/thermal/:itemId/photos` | 열화상 사진 업로드 |
| GET | `/api/reports/preview` | 보고서 미리보기 데이터 |
| POST | `/api/reports/generate` | PDF 생성 |
| GET | `/api/reports/preview-pdf/:filename` | PDF 미리보기 |
| GET | `/api/reports/download/:filename` | PDF 다운로드 |
| POST | `/api/reports/send` | 보고서 SMS 발송 |

---

## 5. 사전 준비 (관리자/배포 측)

1. **DB에 점검원용 단지·세대 등록**
   - `complex`: 이름이 **admin** 인 단지
   - `household`: 해당 단지에 동·호(예: 000-000) 세대 등록
2. **백엔드 환경**
   - JWT 발급 및 `requireInspectorAccess` 미들웨어로 점검원 전용 API 보호
3. **프론트**
   - `inspector.html` + `js/inspector.js` 배포, `api.js`의 `baseURL`이 해당 백엔드를 가리키도록 설정

---

## 6. 요약

- **로그인:** 화면에 ID/비밀번호 입력 없음. **complex=admin, 동/호 000-000** 계정으로 **자동 로그인**.
- **기능:** 하자목록 전체 조회, 하자별 점검결과 입력(공기질/라돈/레벨기/열화상, 사진), 보고서 미리보기·PDF 생성·다운로드·SMS 발송.
